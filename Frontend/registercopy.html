<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Register</title>
    <link rel="icon" href="./img/nomstersicon.png" type="image/x-icon">

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="css/master.css" />
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/register.css" />

    <script src="https://unpkg.com/vue@next"></script>
  </head>

  <body>
    <div id="app">
      <div class="logo-container">
        <img src="img/logo.png" alt="logo" class="logo" />
      </div>
      <div class="container" id="container">
        <div class="form-container register-container" style="overflow:auto">
          <form @submit.prevent="registerUser">
            <h3 class="m-3">Advanced</h3>
            <div class="text-center">
              <label
                for="form-control"
                class="form-label chooseprofilepic"
                style="color: black"
                >Choose Profile Picture</label
              >
              <img id="frame" :src="imagePreview" class="img-fluid" />
              <input
                class="form-control fileinput"
                type="file"
                id="formFile"
                @change="previewImage"
                ref="fileInput"
                required
              />
              <button @click="clearImage" class="btn1 btn btn-danger mt-3 clear"
                      style="
                        font-weight: lighter;
                        position: relative;
                        z-index: 9999;
                      ">
                Clear Image
              </button>
              
              </div>
              <div class="container text-start">
                <h4 class="text-center">Special Diet</h4>
              <div v-for="diet in diets" class="" :key="diet.id">
                <input
                  v-model="selectedDiets"
                  class="form-check-input"
                  type="checkbox"
                  :value="diet.value"
                  :id="diet.id"
                />
                <label class="form-check-label" :for="diet.id"
                  >{{diet.value}}</label
                >
              </div>
            </div>
          </form>
        </div>
  
        <div class="form-container login-container">
          <form class="form-lg" @submit.prevent="registerUser">
            <h3>Your Journey Begins <i>Here.</i></h3>
            <div class="mb-1">
              <input
                v-model="username"
                type="text"
                class="form-control"
                id="exampleInputUsername1"
                placeholder="Username"
                required
              />
            </div>
            <div class="mb-1">
              <input v-model="password"
              type="password"
              class="form-control"
              id="exampleInputPassword1"
              placeholder="Password"
              required
              />
            </div>
            <div class="mb-1">
              <input
              v-model="confirmPassword"
              type="password"
              class="form-control"
              id="exampleInputPassword2"
              placeholder="Confirm Password"
              required
              />
            </div>

            <!-- <button type="submit" value="submit">Login</button> -->
            <button
                      type="submit"
                      class="btn1 btn btn-danger"
                      style="
                        font-weight: lighter;
                        position: relative;
                        z-index: 9999;
                      "
                    >
                      Register
                    </button>
          </form>
        </div>
  
        <div class="overlay-container">
          <div class="overlay">
            <div class="overlay-panel overlay-left">
              <h1 class="title">
                Almost There!
              </h1>
              <p>Return to complete registration</p>
              <button class=" btn btn-dark" style="
              font-weight: lighter;
              position: relative;
              z-index: 9999;
            " id="login">
                Return
                <!-- <i class="fa-solid fa-arrow-right"></i> -->
              </button>
            </div>
  
            <div class="overlay-panel overlay-right">
              <h3 class="title">
                Make this account <i style="color:white;">yours.</i>
              </h3>
              <!-- <p>
                Advanced settings here
              </p> -->
              <button class=" btn btn-dark" style="
              font-weight: lighter;
              position: relative;
              z-index: 9999;
            " id="register">
                Advanced
                <!-- <i class="fa-solid fa-arrow-right"></i> -->
              </button>
              
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="container-fluid mt-5 mb-5">
        <div class="row">
          left column
          <div class="col-4">
            <div class="text-center">
              <label
                for="form-control"
                class="form-label chooseprofilepic"
                style="color: black"
                >Choose Profile Picture</label
              >
              <img id="frame" :src="imagePreview" class="img-fluid" />
              <input
                class="form-control fileinput"
                type="file"
                id="formFile"
                @change="previewImage"
                ref="fileInput"
                required
              />
              <button @click="clearImage" class="btn btn-secondary mt-3 clear">
                Clear Image
              </button>
            </div>
          </div>

          center column
          <div class="col-4">
            <div class="row">
              <div class="form">
                <div class="logo-container">
                  <img src="img/logo.png" alt="logo" class="logo" />
                </div>
                <form @submit.prevent="registerUser">
                  <div class="mb-3">
                    <input
                      v-model="username"
                      type="text"
                      class="form-control"
                      id="exampleInputUsername1"
                      placeholder="Username"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <input
                      v-model="password"
                      type="password"
                      class="form-control"
                      id="exampleInputPassword1"
                      placeholder="Password"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <input
                      v-model="confirmPassword"
                      type="password"
                      class="form-control"
                      id="exampleInputPassword2"
                      placeholder="Confirm Password"
                      required
                    />
                  </div>
                  <div class="text-center">
                    <button
                      type="submit"
                      class="btn btn-danger"
                      style="
                        font-weight: lighter;
                        position: relative;
                        z-index: 9999;
                      "
                    >
                      Register
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <div class="filler col-1"></div>
          right column
          <div class="col-2 rightcol">
            <div class="p-3 py-5 mt-5">
              <br /><br />
              <div class="d-flex justify-content-between align-items-center">
                <h4>Special Diet</h4>
              </div>
              <br />
              <div v-for="diet in diets" class="form-check" :key="diet.id">
                <input
                  v-model="selectedDiets"
                  class="form-check-input"
                  type="checkbox"
                  :value="diet.value"
                  :id="diet.id"
                />
                <label class="form-check-label" :for="diet.id"
                  >{{diet.value}}</label
                >
              </div>
            </div>
          </div>
        </div>
      </div> -->
      <!-- app end div below -->
    </div>
    <div class="ocean">
      <div class="wave"></div>
      <div class="wave"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      const app = Vue.createApp({
        data() {
          return {
            username: "",
            password: "",
            confirmPassword: "",
            imagePreview: "",
            diets: [],
            selectedDiets: [],
          };
        },
        mounted() {
          this.fetchDiets();
        },
        methods: {
          fetchDiets() {
            axios
              .get("https://leaptron2.dscloud.me:3000/api/diet")
              .then((response) => {
                this.diets = response.data.map((item) => ({
                  id: item.name.replace(/\s+/g, "_").toLowerCase(),
                  value: item.name,
                  checked: false,
                }));
              })
              .catch((error) => {});
          },
          previewImage() {
            this.imagePreview = URL.createObjectURL(
              this.$refs.fileInput.files[0]
            );
          },
          clearImage() {
            this.imagePreview = "";
            this.$refs.fileInput.value = null;
          },
          registerUser() {
            if (this.password !== this.confirmPassword) {
              alert("Passwords do not match.");
              return;
            }

            var file = this.$refs.fileInput.files[0];

            if (file) {
              this.readAndUploadFile(file)
                .then((fileData) => {
                  axios
                    .post("https://leaptron2.dscloud.me:3000/api/signup", {
                      username: this.username,
                      password: this.password,
                      image: fileData,
                    })
                    .then((response) => {
                      let token = response.data.token;
                      let userId = response.data.userId;
                      sessionStorage.setItem("token", token);
                      sessionStorage.setItem("userId", userId);
                      const selectedDiets = this.selectedDiets;
                      var dietdata = "";

                      if (selectedDiets.length > 0) {
                        for (let i = 0; i < selectedDiets.length; i++) {
                          dietdata += selectedDiets[i];
      
                          // Add a comma and space if it's not the last item
                          if (i < selectedDiets.length - 1) {
                              dietdata += ", ";
                          }
                        }
    
                        const headers = {
                          Authorization: `Bearer ${token}`,
                        };
                        
                        axios.post(`https://leaptron2.dscloud.me:3000/api/user/${userId}/diet`, 
                          {
                            diets: dietdata, // Ensure the property name is 'diets', not 'dietdata'
                          },
                          {
                            headers: headers, // Pass the headers as a separate object
                          }
                        )
                        .then((response) => {
                          const homePageUrl = `./home.html`;
                          window.location.href = homePageUrl;
                        })
                        .catch((error) => {
                        });
                        
                      } else {
                        const homePageUrl = `./home.html`;
                        window.location.href = homePageUrl;
                      }
                    });

                })
                .catch((error) => {
                  console.error(error);
                });
            } else {
              axios
                .post("https://leaptron2.dscloud.me:3000/api/signup", {
                  username: this.username,
                  password: this.password,
                  image: "",
                })
                .then((response) => {
                  let token = response.data.token;
                  let userId = response.data.userId;
                  sessionStorage.setItem("token", token);
                  sessionStorage.setItem("userId", userId);
                  const selectedDiets = this.selectedDiets;

                  var dietdata = "";

                  if (selectedDiets.length > 0) {
                    for (let i = 0; i < selectedDiets.length; i++) {
                      dietdata += selectedDiets[i];

                      // Add a comma and space if it's not the last item
                      if (i < selectedDiets.length - 1) {
                        dietdata += ", ";
                      }
                    }

                    const headers = {
                      Authorization: `Bearer ${token}`,
                    };

                    axios
                      .post(
                        `https://leaptron2.dscloud.me:3000/api/user/${userId}/diet`,
                        {
                          diets: dietdata, // Ensure the property name is 'diets', not 'dietdata'
                        },
                        {
                          headers: headers, // Pass the headers as a separate object
                        }
                      )
                      .then((response) => {
                        const homePageUrl = `./home.html`;
                        window.location.href = homePageUrl;
                      })
                      .catch((error) => {
                      });
                  } else{
                    const homePageUrl = `./home.html`;
                    window.location.href = homePageUrl;
                  }
                });
            }
          },
          readAndUploadFile(file) {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();

              reader.onload = function (e) {
                const fileData = e.target.result;
                resolve(fileData);
              };

              reader.onerror = function (error) {
                reject(error);
              };

              reader.readAsDataURL(file);
            });
          },
        },
      });
      app.mount("#app");
    </script>

    <script>
      // Animations
const registerButton = document.getElementById("register");
const loginButton = document.getElementById("login");
const container = document.getElementById("container");

registerButton.addEventListener("click", () => {
  container.classList.add("right-panel-active");
});

loginButton.addEventListener("click", () => {
  container.classList.remove("right-panel-active");
});




    </script>
  </body>
</html>
