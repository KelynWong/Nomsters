<!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <link rel="stylesheet" href="css/master.css">
    <link rel="stylesheet" href="css/home.css">

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue@next"></script>
  </head>
  

  <style>
      .add, .remove {
          /* margin-top: 5px; */
          margin-right: 5px;
          padding-top: 5px;
      }



      .img-fluid {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 50%;
      }
  </style>

  <body>
    <script>
      const token = sessionStorage.getItem('token');
      const userId = sessionStorage.getItem('userId');
        
      if (!token || !userId) {
          // If 'token' or 'userId' doesn't exist, redirect to 'index.html'
          window.location.href = './index.html';
      } 
    </script>
    <div id="app">
      <app-nav :allrecipes="allrecipes" @search="searchRecipes"></app-nav>

      <div class="container col-8">

        <img id="frame" src="" class="img-fluid mx-auto" />
      
        <form @submit.prevent="submitRecipe">

      <!-- Text Fields -->
      <div class="mb-3">
        <label for="recipeName" class="form-label">Recipe Name</label>
        <textarea v-model="formData.title" class="form-control" id="recipeName" rows="1"></textarea>
      </div>

      <div class="mb-2 text-center">
        <label for="formFile" class="form-label chooseprofilepic" style="color: black; text-align: start !important;">Choose Recipe Photo</label>
        <input v-model="formData.image" type="file" class="form-control" id="formFile" onchange="preview()" placeholder="upload profile pic">
        <button onclick="clearImage()" class="btn btn-secondary mt-3 clear">Clear Image</button>
      </div>

      <div class="row 2">
        <div class="mb-3 col-6">
          <label for="recipeDirections" class="form-label">Recipe Directions</label>
          <div v-for="(step, index) in formData.direction" :key="index" id="formfield">
            <input v-model="formData.direction[index]" type="text" class="form-control" :id="'textbox' + index" :placeholder="'Step ' + (index + 1)">
          </div>
          <button class="add btn btn-secondary mr-3" @click="addRecipe" type="button">Add</button>
          <button class="remove btn btn-secondary mr-3" @click="removeRecipe" type="button">Remove</button>
        </div>

        </div>
        <div class="row 2">
          <div class="mb-3 col-6">
            <label for="recipeIngredients" class="form-label">Ingredients</label>
            <div v-for="(step, index) in formData.ingredient" :key="index" id="formfield">
              <input v-model="formData.ingredient[index]" type="text" class="form-control" :id="'textbox' + index" :placeholder="'Step ' + (index + 1)">
            </div>
            <button class="add btn btn-secondary mr-3" @click="addIngredient" type="button">Add</button>
            <button class="remove btn btn-secondary mr-3" @click="removeIngredient" type="button">Remove</button>
          </div>
      </div>

      <!-- Numeric Fields -->
      <div class="row">
        <div class="form-outline col-4">
          <label class="form-label" for="preparationTime">Preparation Time (mins)</label>
          <input v-model="formData.preparationTime" type="number" class="form-control" id="preparationTime" placeholder="120"/>
        </div>
        <div class="form-outline col-4">
          <label class="form-label" for="servings">Number of Servings</label>
          <input v-model="formData.servings" type="number" class="form-control" id="servings" placeholder="4"/>
        </div>
        <div class="form-outline col-4">
          <label class="form-label" for="pricePe  rServing">Price (per serving in $)</label>
          <input v-model="formData.pricePerServing" type="number" class="form-control" id="pricePerServing" placeholder="eg. $2"/>
        </div>
      </div>

      <!-- Checkboxes -->
      <div class="form-check" v-for="option in options" :key="option.value">
        <input v-model="formData[option.value]" class="form-check-input" type="checkbox" :value="true">
        <label class="form-check-label">{{ option.label }}</label>
      </div>

      <div class="text-center">
        <button type="submit" class="btn btn-danger" style="font-weight:lighter">Submit Recipe</button>
      </div>
          </form>
              </div>
          </div>
      </div>
      
      
      
        
      <app-footer></app-footer>
    </div>

    <!-- script for add and remove buttons -->

    <script>


      function removeRecipe(){
        var input_tags = formfield.getElementsByTagName('input');
        if(input_tags.length > 1) {
            formfield.removeChild(input_tags[(input_tags.length) - 1]);
        }
      }


    </script>

    <!-- script for image preview -->
    <script>
      function preview() {
                  frame.src = URL.createObjectURL(event.target.files[0]);
              }
              function clearImage() {
                  document.getElementById('formFile').value = null;
                  frame.src = "";
              }
    </script>


    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
      crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script src="component/navbar.js"></script>
    <script src="component/listing.js"></script>
    <script src="component/footer.js"></script>

    <script>
      const app = Vue.createApp({
        components: {
          'app-footer': footer,
        },
        data() {
          return {
            allrecipes: [],
            
            formData: {
          title: '',
          image: null,
          preparationTime: 0,
          servings: 0,
          pricePerServing: 0,
          direction: [''], // for recipe directions
          ingredient: [''], // for ingredients
          // Add other form fields here and initialize them
          options: [
          { label: 'Vegetarian', value: 'vegetarian' },
          { label: 'Vegan', value: 'vegan' },
          { label: 'Gluten Free', value: 'glutenFree' },
          { label: 'Dairy Free', value: 'dairyFree' },
          { label: 'Healthy', value: 'veryHealthy' },
          { label: 'Cheap', value: 'cheap' },
        ],
        },

        
          };
        },
        mounted() {
          this.fetchAllRecipes();
        },
        methods: {
          searchRecipes(titleQuery){
              window.location.href = `allRecipe.html?search=${titleQuery}`;
          },
          fetchAllRecipes(){
            const headers = {
            Authorization: `BEARER ${token}`
          }
              axios.get('https://leaptron2.dscloud.me:3000/api/recipe', {
                  headers:headers
              }).then(response => {
                  console.log(response.data)
                  this.allrecipes = response.data
                  console.log(this.allrecipes)
              }).catch( error => {
                  console.log(error.response.data.message);
                  this.errorMessage = error.response.data.message;
                  this.allrecipes = [];
                  this.isError = true;
              });
          },
          addRecipe() {
      // Add a new recipe step to the formData.direction array
      this.formData.direction.push('');
      },

      removeRecipe(index) {
      // Remove the recipe step at the specified index
      this.formData.direction.splice(index, 1);
    },
    addIngredient() {
      this.formData.ingredient.push('');
    },
    removeIngredient(index) {
      // Remove the recipe step at the specified index
      this.formData.ingredient.splice(index, 1);
    },
    submitRecipe() {
      console.log(this.formData);
    },
      },computed:{formDataWithCheckboxes() {
    const data = { ...this.formData };
    for (const option of this.options) {
      data[option.value] = false;
    }
    return data;
  },}
      });
      
      app.component('app-nav', {
        data() {
            return {
                showIsActive: false,
                random: []
            }
        },
        props: {
            allrecipes: {
                type: Array,
                required: true
            },
            size: {
                type: Number,
                required: false,
                default: 12
            }
        },
        methods: {
            showHideModal() {
                this.showIsActive = !this.showIsActive;

                this.generateRandomRecipe();
            },
            generateRandomRecipe() {
                if (this.allrecipes.length > 0) {
                    const length = this.allrecipes.length;
                    const r = this.allrecipes[Math.floor(Math.random() * length)];
        
                    console.log(this.random);
                    this.random = r;
                }
            },
            closeModal() {
                this.showIsActive = !this.showIsActive;
            },
        },
        template: navbar.template + `
            <div class="random-recipe" :class="{active: showIsActive}">
                <div class="overlay" @click="closeModal"></div>
                <div class="modal-box">
                    <h3>Random Recipe Generator</h3>
                    ${listing.single}
                    <div class="buttons">
                        <!-- <button class="btn close-btn" @click="showHideModal">Close</button> -->
                        <button class="btn decide-btn generate" @click="generateRandomRecipe">Regenerate</button>
                        <button class="btn decide-btn generate"><a href="recipeDetail.html?">Go to Recipe</a></button>
                    </div>
                </div>
            </div>
          `,
      });

      app.component('app-listing', listing);

      app.mount('#app');

      gsap.from("#countRecipe", {
        textContent: 0,
        duration: 4,
        ease: "power1.in",
        snap: { textContent: 1 }
      });

      const buttons = document.querySelectorAll(".topRecipe");

      buttons.forEach(function (button) {
        button.addEventListener("click", function () {
          buttons.forEach(function (btn) {
            btn.classList.remove("btn-danger");
            btn.classList.add("btn-outline-secondary");

            var rmv = document.getElementById(btn.getAttribute("data-value"));
            rmv.style.display = 'none';
          });

          var content = document.getElementById(event.target.getAttribute("data-value"));
          content.style.display = 'block';
        });
      });

    </script>
  </body>

  </html>