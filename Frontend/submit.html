<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

  <link rel="stylesheet" href="css/master.css">
  <link rel="stylesheet" href="css/home.css">

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/vue@next"></script>
</head>

<style>
    .add, .remove {
        /* margin-top: 5px; */
        margin-right: 5px;
        padding-top: 5px;
    }

    #formfield, #textbox, #formfield2, #textbox2 {
        margin-bottom: 5px;
    }

    .img-fluid {
      display: block;
      margin-left: auto;
      margin-right: auto;
      max-width: 50%;
    }
</style>

<body>
  <div id="app">
    <app-nav :allrecipes="allrecipes" @search="searchRecipes"></app-nav>

    <div class="container col-8">

      <img id="frame" src="" class="img-fluid mx-auto" />

    <!-- Text Fields -->
    <div class="mb-3">
        <label for="" class="form-label">Recipe Name</label>
        <textarea class="form-control" value="" id="" rows="1"></textarea>
      </div>

      <div class="mb-2 text-center">
        <label for="form-control" class="form-label chooseprofilepic" style="color:black; text-align: start !important;">Choose Recipe Photo</label>
        <input class="form-control" type="file" id="formFile" onchange="preview()" placeholder="upload profile pic">
        <button onclick="clearImage()" class="btn btn-secondary mt-3 clear">Clear Image</button>
    </div>

      <div class="row 2">
        <div class="mb-3 col-6" id="">
            <label for="" class="form-label">Recipe Directions</label>
            <div id="formfield">
                <input class="form-control" rows="1" type="text" id="textbox" placeholder="1. Prepare...">
            </div>
            
            <div class="controls">
                <button class="add btn btn-secondary mr-3" onclick="addRecipe()">Add</button>
                <button class="remove btn btn-secondary mr-3" onclick="removeRecipe()">Remove</button>
            </div>
          </div>
          <div class="mb-3 col-6">
              <label for="" class="form-label">Ingredients</label>
              <div id="formfield2">
                <input type="text" class="form-control" value="" id="textbox2" rows="1"  placeholder="1. 2 beautiful onions"></textarea>


              </div>
              <div class="controls">
                <button class="add btn btn-secondary mr-3" onclick="addIngredient()">Add</button>
                <button class="remove btn btn-secondary mr-3" onclick="removeIngredient()">Remove</button>
              </div>
            </div>
      </div>
      
    <!-- numeric -->
    <div class="row">
        <div class="form-outline col-4">
            <label class="form-label" for="typeNumber">Preparation Time (mins)</label>
            <input type="number" id="typeNumber" value="preperationMinutes" class="form-control" placeholder="120"/>
        </div>
        <div class="form-outline col-4">
            <label class="form-label" for="typeNumber">Number of Servings</label>
            <input type="number" id="typeNumber" value="" class="form-control" placeholder="4"/>
        </div>
        <div class="form-outline col-4">
            <label class="form-label" for="typeNumber">Price (per serving in $)</label>
            <input type="number" id="typeNumber" value="" class="form-control" placeholder="eg. $2"/>
        </div>
    </div>
      

      <br>
      <!-- checkboxes -->
      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="vegetarian" id="">
        <label class="form-check-label" for="">
          Vegetarian
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="vegan" id="">
        <label class="form-check-label" for="">
          Vegan
        </label>
      </div>
      <div class="form-check">
          <input class="form-check-input" type="checkbox" value="glutenFree" id="">
          <label class="form-check-label" for="">
            Gluten Free
          </label>
      </div>
      <div class="form-check">
          <input class="form-check-input" type="checkbox" value="dairyFree" id="">
          <label class="form-check-label" for="">
          Dairy Free
      </label>
      </div>
      <div class="form-check">
          <input class="form-check-input" type="checkbox" value="veryHealthy" id="">
          <label class="form-check-label" for="">
          Healthy
      </label>
      </div>
      <div class="form-check">
          <input class="form-check-input" type="checkbox" value="cheap" id="">
          <label class="form-check-label" for="">
          Cheap
      </label>
      </div>

        <div class="text-center">
            <button type="submit" class="btn btn-danger" style="font-weight:lighter">Submit Recipe</button>
        </div>
    </div>
    
    
    
      
    <app-footer></app-footer>
  </div>

  <!-- script for add and remove buttons -->

  <script>
    function addRecipe(){
      var newField = document.createElement('input');
      newField.setAttribute('type','text');
      newField.setAttribute('name','text');
      newField.setAttribute('id','textbox');
      newField.setAttribute('class','form-control');
      newField.setAttribute('size',50);
      newField.setAttribute('placeholder','Add next step here');
      formfield.appendChild(newField);
    }

    function removeRecipe(){
      var input_tags = formfield.getElementsByTagName('input');
      if(input_tags.length > 1) {
          formfield.removeChild(input_tags[(input_tags.length) - 1]);
      }
    }

    function addIngredient(){
      var newField = document.createElement('input');
      newField.setAttribute('type','text');
      newField.setAttribute('name','text');
      newField.setAttribute('id','textbox2');
      newField.setAttribute('class','form-control');
      newField.setAttribute('size',50);
      newField.setAttribute('placeholder','Add next ingredient here');
      formfield2.appendChild(newField);
    }

    function removeIngredient(){
      var input_tags = formfield2.getElementsByTagName('input');
      if(input_tags.length > 1) {
          formfield2.removeChild(input_tags[(input_tags.length) - 1]);
      }
    }
  </script>

  <!-- script for image preview -->
  <script>
    function preview() {
                frame.src = URL.createObjectURL(event.target.files[0]);
            }
            function clearImage() {
                document.getElementById('formFile').value = null;
                frame.src = "";
            }
  </script>


  <!-- Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <script src="component/navbar.js"></script>
  <script src="component/listing.js"></script>
  <script src="component/footer.js"></script>

  <script>
    const app = Vue.createApp({
      components: {
        'app-footer': footer,
      },
      data() {
        return {
          allrecipes: []
        };
      },
      mounted() {
        this.fetchAllRecipes();
      },
      methods: {
        searchRecipes(titleQuery){
            window.location.href = `allRecipe.html?search=${titleQuery}`;
        },
        fetchAllRecipes(){
            axios.get('https://leaptron2.dscloud.me:3000/api/recipe', {
                headers:{
                    Authorization: "BEARER eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MTY5ODA0MzIwNCwiZXhwIjoxNjk4MTI5NjA0fQ.C5O7wzyWIo-1vGPBPGHtDyOTMVBvtReAZL9NKKJsOaw"
                }
            }).then(response => {
                console.log(response.data)
                this.allrecipes = response.data
                console.log(this.allrecipes)
            }).catch( error => {
                console.log(error.response.data.message);
                this.errorMessage = error.response.data.message;
                this.allrecipes = [];
                this.isError = true;
            });
        },
      }
    });
    
    app.component('app-nav', {
      data() {
          return {
              showIsActive: false,
              random: []
          }
      },
      props: {
          allrecipes: {
              type: Array,
              required: true
          },
          size: {
              type: Number,
              required: false,
              default: 12
          }
      },
      methods: {
          showHideModal() {
              this.showIsActive = !this.showIsActive;

              this.generateRandomRecipe();
          },
          generateRandomRecipe() {
              if (this.allrecipes.length > 0) {
                  const length = this.allrecipes.length;
                  const r = this.allrecipes[Math.floor(Math.random() * length)];
      
                  console.log(this.random);
                  this.random = r;
              }
          },
          closeModal() {
              this.showIsActive = !this.showIsActive;
          },
      },
      template: navbar.template + `
          <div class="random-recipe" :class="{active: showIsActive}">
              <div class="overlay" @click="closeModal"></div>
              <div class="modal-box">
                  <h3>Random Recipe Generator</h3>
                  ${listing.single}
                  <div class="buttons">
                      <!-- <button class="btn close-btn" @click="showHideModal">Close</button> -->
                      <button class="btn decide-btn" @click="generateRandomRecipe">Regenerate</button>
                      <button class="btn decide-btn"><a href="recipeDetail.html?">Go to Recipe</a></button>
                  </div>
              </div>
          </div>
        `,
    });

    app.component('app-listing', listing);

    app.mount('#app');

    gsap.from("#countRecipe", {
      textContent: 0,
      duration: 4,
      ease: "power1.in",
      snap: { textContent: 1 }
    });

    const buttons = document.querySelectorAll(".topRecipe");

    buttons.forEach(function (button) {
      button.addEventListener("click", function () {
        buttons.forEach(function (btn) {
          btn.classList.remove("btn-danger");
          btn.classList.add("btn-outline-secondary");

          var rmv = document.getElementById(btn.getAttribute("data-value"));
          rmv.style.display = 'none';
        });

        var content = document.getElementById(event.target.getAttribute("data-value"));
        content.style.display = 'block';
      });
    });

  </script>
</body>

</html>